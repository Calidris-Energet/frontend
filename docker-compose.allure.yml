version: '3.8'

services:
  allure-generate:
    image: frankescobar/allure-docker-service
    environment:
      CHECK_RESULTS_EVERY_SECONDS: 1
    volumes:
      - ./allure-results:/app/allure-results
      - ./allure-report:/app/default-reports
    command: >
      sh -c "
      echo 'Generating static report...' &&
      java -jar /app/allure-docker-service-exec.jar &
      sleep 10 &&
      curl -X POST http://localhost:5050/generate-report &&
      sleep 5 &&
      cp -r /app/default-reports/latest-report/* /app/default-reports/ &&
      echo 'Report generated!'"
